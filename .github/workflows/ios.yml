name: iOS starter workflow

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    name: Build and Test default scheme using any available iPhone simulator
    runs-on: macos-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Force Xcode 13
        run: sudo xcode-select -switch /Applications/Xcode_13.1.app
      - name: iOS build setup
        run: >-
          xcodebuild test -xcodeproj PhotoViewer.xcodeproj
          -scheme TestApp -destination 'platform=iOS Simulator,name=iPhone
          13,OS=15.0'
      - name: testing ... iPhone 13 Pro Max
        run: >-
          xcodebuild test -xcodeproj PhotoViewer.xcodeproj
          -scheme TestApp -destination 'platform=iOS Simulator,name=iPhone 13
          Pro Max,OS=15.0'
      - name: testing ... iPhone 8
        run: >-
          xcodebuild test -xcodeproj PhotoViewer.xcodeproj
          -scheme TestApp -destination 'platform=iOS Simulator,name=iPhone
          8,OS=15.0'
      - name: Prepare iOS 12 simulator - XCode 10.3
        run: |
          sudo mkdir -p /Library/Developer/CoreSimulator/Profiles/Runtimes
          sudo ln -s /Applications/Xcode_10.3.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/Library/CoreSimulator/Profiles/Runtimes/iOS.simruntime /Library/Developer/CoreSimulator/Profiles/Runtimes/iOS\ 12.4.simruntime
          xcrun simctl list runtimes
          xcrun simctl create custom-test-device "iPad Pro (9.7-inch)" "com.apple.CoreSimulator.SimRuntime.iOS-12-4"
          xcrun simctl list devices 12.4
